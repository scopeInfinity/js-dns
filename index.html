<html>
  <body>
    <div id="msg">
      JS not yet executed.
    </div>
    <script type="text/javascript" src="dns_resolver.js"></script>
    <script>
        function appendMessage(str) {
            var msg = document.getElementById("msg");
            msg.innerHTML += "<br>" + str;
            console.log(str);
        }
        function parse_and_redirect() {
            appendMessage("JS running, trying to match query.");
            var query = get_dns_query();
            get_destination(query).then(destination => {
                appendMessage("destination:" + destination);
                if (destination != null) {
                    appendMessage("Match found, redirecting...");
                    window.location.href = destination;
                } else {
                    appendMessage("Not match found.");
                }
            });
        }
        parse_and_redirect();
    </script>
  </body>
</html>
